<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Learning Schedule Tracker</title>
    <style>
      body {
        background: #121212;
        color: #e0e0e0;
        font-family: system-ui, sans-serif;
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      h1 {
        text-align: center;
        margin-bottom: 20px;
      }
      .month {
        margin-bottom: 30px;
      }
      .day {
        background: #1e1e1e;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 3rem;
        display: flex;
        flex-direction: column;
        gap: 0.6rem;
        line-height: 1.4;
      }
      .day-top {
        display: flex;
        align-items: center;
      }
      input[type="checkbox"] {
        margin-right: 10px;
        transform: scale(1.3);
      }
      .topic {
        font-weight: bold;
      }
      .background {
        margin-left: 28px;
        font-size: 0.9em;
        color: #a0a0a0;
      }
      #schedule {
        max-width: 850px;
      }
      #today {
        box-shadow: 0 0 10px 2px #fff;
        border: 1px solid #fff;
      }
    </style>
  </head>
  <body>
    <h1>Git Gud</h1>
    <div id="schedule"></div>
    <script>
      const scheduleContainer = document.getElementById("schedule");

      fetch("schedule.json")
        .then((res) => res.json())
        .then((data) => {
          const grouped = data.reduce((acc, day) => {
            const month = new Date(day.date).toLocaleString("default", {
              month: "long",
              year: "numeric",
            });
            if (!acc[month]) acc[month] = [];
            acc[month].push(day);
            return acc;
          }, {});

          for (const [month, days] of Object.entries(grouped)) {
            const monthDiv = document.createElement("div");
            monthDiv.classList.add("month");
            const title = document.createElement("h2");
            title.textContent = month;
            monthDiv.appendChild(title);

            days.forEach((day) => {
              const dayDiv = document.createElement("div");
              dayDiv.classList.add("day");
              // Check if this is today while creating
              const todayStr = new Date().toISOString().slice(0, 10);
              if (day.date === todayStr) {
                dayDiv.id = "today";
              }

              const top = document.createElement("div");
              top.classList.add("day-top");

              const checkbox = document.createElement("input");
              checkbox.type = "checkbox";
              checkbox.checked = localStorage.getItem(day.date) === "done";
              checkbox.addEventListener("change", () => {
                if (checkbox.checked) {
                  localStorage.setItem(day.date, "done");
                } else {
                  localStorage.removeItem(day.date);
                }
              });

              const topic = document.createElement("div");
              topic.classList.add("topic");
              topic.textContent = `${day.date}: ${day.topic}`;

              top.appendChild(checkbox);
              top.appendChild(topic);

              const background = document.createElement("div");
              background.classList.add("background");
              background.textContent = day.background;

              dayDiv.appendChild(top);
              dayDiv.appendChild(background);
              monthDiv.appendChild(dayDiv);
            });

            scheduleContainer.appendChild(monthDiv);
          }
        });

      const todayStr = new Date().toISOString().slice(0, 10);
      console.log(todayStr);
      const todayEl = document.querySelector(`.day[data-date='${todayStr}']`);
      console.log(todayEl);
      if (todayEl) {
        todayEl.classList.add("today");
        todayEl.scrollIntoView({ behavior: "smooth", block: "center" });
      }
    </script>
  </body>
</html>
